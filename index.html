<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Ticket Generator Bioskop</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat library styling dan CSS custom -->
    <style>
        /* Menggunakan font mesin tik/jadul */
        .typewriter-font {
            font-family: 'Courier New', monospace;
        }
        /* Custom styling untuk tampilan tiket */
        .ticket-container {
            /* Desain Vertikal (seperti struk / 9:16) */
            width: 100%;
            max-width: 350px; /* Lebar yang sesuai untuk ponsel */
            min-height: 550px; /* Tinggi yang memanjang */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            background-color: #fff;
            display: flex; /* Aktifkan Flexbox */
            flex-direction: column; /* Susun ke bawah */
        }
        /* Efek robekan (perforasi) - Dibuat horizontal */
        .tear-off-line {
            background-image: linear-gradient(to right, #000 33%, rgba(255, 255, 255, 0) 0%);
            background-position: bottom;
            background-size: 20px 2px;
            background-repeat: repeat-x;
            width: 100%;
        }

        /* Penyesuaian untuk tampilan mobile: form di atas, tiket di bawah */
        @media (max-width: 1023px) {
            .lg\:flex-row {
                flex-direction: column;
            }
            .lg\:w-1\/3, .lg\:w-2\/3 {
                width: 100%;
            }
            .lg\:pt-8 {
                padding-top: 1rem;
            }
        }
        
        /* Warna utama dan latar belakang */
        body {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-gray-800 typewriter-font">
            Generator E-Ticket Bioskop
        </h1>

        <div class="flex flex-col lg:flex-row gap-8">
            
            <!-- Kolom Input Form (Admin Panel) -->
            <div class="lg:w-1/3 bg-white p-6 rounded-lg shadow-xl border border-gray-100 typewriter-font">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2">Input Data Tiket</h2>
                <form id="ticket-form" class="space-y-4">
                    
                    <div>
                        <label for="movieTitle" class="block text-sm font-medium text-gray-700">Judul Film</label>
                        <input type="text" id="movieTitle" name="movieTitle" value="Avengers: Endgame" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-red-500 focus:border-red-500" required>
                    </div>

                    <div>
                        <label for="ticketType" class="block text-sm font-medium text-gray-700">Tipe Tiket</label>
                        <select id="ticketType" name="ticketType" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-red-500 focus:border-red-500">
                            <option value="Standard">STANDARD</option>
                            <option value="3D">3D</option>
                            <option value="IMAX">IMAX</option>
                            <option value="The Premiere">THE PREMIERE</option>
                        </select>
                    </div>

                    <div class="flex space-x-4">
                        <div class="w-1/2">
                            <label for="theaterNum" class="block text-sm font-medium text-gray-700">Studio (Theater)</label>
                            <input type="number" id="theaterNum" name="theaterNum" value="2" min="1" max="99" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                        </div>
                        <div class="w-1/4">
                            <label for="seatRow" class="block text-sm font-medium text-gray-700">Baris (Row)</label>
                            <input type="text" id="seatRow" name="seatRow" value="D" maxlength="1" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 uppercase text-center" required>
                        </div>
                        <div class="w-1/4">
                            <label for="seatNum" class="block text-sm font-medium text-gray-700">Kursi (Seat)</label>
                            <input type="number" id="seatNum" name="seatNum" value="12" min="1" max="99" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 text-center" required>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <div class="w-1/2">
                            <label for="date" class="block text-sm font-medium text-gray-700">Tanggal</label>
                            <input type="date" id="date" name="date" value="2025-10-19" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                        </div>
                        <div class="w-1/2">
                            <label for="time" class="block text-sm font-medium text-gray-700">Jam Tayang</label>
                            <input type="time" id="time" name="time" value="14:00" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                        </div>
                    </div>

                    <div>
                        <label for="price" class="block text-sm font-medium text-gray-700">Harga (IDR)</label>
                        <input type="number" id="price" name="price" value="50000.00" min="0" step="1000" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" required>
                    </div>
                    
                    <button type="button" id="save-button" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out mt-6">
                        <span id="loading-message" class="hidden">Memproses...</span>
                        <span id="save-text">SIMPAN & UNDUH (JPG)</span>
                    </button>
                    <p class="text-xs text-gray-500 pt-2 text-center">Nomor serial baru akan dibuat otomatis setelah unduhan berhasil.</p>
                </form>
            </div>

            <!-- Kolom Preview Tiket -->
            <div class="lg:w-2/3 flex justify-center items-start lg:pt-8">
                <!-- TIKET VERTICAL DIMULAI DI SINI -->
                <div id="ticket-preview" class="ticket-container bg-white rounded-lg overflow-hidden flex flex-col border-4 border-gray-900 typewriter-font">

                    <!-- BAGIAN UTAMA (ATAS) - Mengambil sebagian besar ruang -->
                    <div class="w-full bg-white p-6 flex-grow text-gray-900">
                        <div class="flex justify-between items-center mb-4 border-b border-gray-300 pb-2">
                            <h2 class="text-2xl font-extrabold uppercase tracking-widest">CINEMA TICKET</h2>
                            <!-- Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-red-600" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm-1 15v-6h2v6h-2zm0-8V7h2v2h-2z"/>
                            </svg>
                        </div>

                        <div class="mb-6">
                            <div id="main-title" class="text-4xl font-extrabold uppercase leading-none break-words">MOVIE TITLE</div>
                            <div class="text-base font-medium mt-1 text-gray-600" id="main-type">STANDARD</div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 text-sm mb-6">
                            <div>
                                <div class="text-gray-500">DATE</div>
                                <div id="main-date" class="text-lg font-bold">19/10/2025</div>
                            </div>
                            <div>
                                <div class="text-gray-500">TIME</div>
                                <div id="main-time" class="text-lg font-bold">14:00</div>
                            </div>
                            <div>
                                <div class="text-gray-500">STUDIO</div>
                                <div id="main-theater" class="text-xl font-bold">2</div>
                            </div>
                            <div>
                                <div class="text-gray-500">SEAT</div>
                                <div id="main-seat" class="text-xl font-bold">D12</div>
                            </div>
                        </div>

                        <!-- Bagian Bawah: Harga dan Serial Number yang lebih menonjol -->
                        <div class="border-t border-gray-300 pt-4">
                            <div class="space-y-1">
                                <div class="text-xs text-gray-500">PRICE</div>
                                <div id="main-price" class="text-3xl font-extrabold text-red-600">IDR 50.000,00</div>
                            </div>

                            <div class="space-y-1 mt-4">
                                <div class="text-xs text-gray-500">VALIDATION SERIAL NUMBER</div>
                                <div id="main-serial" class="text-xl font-bold tracking-widest text-gray-900 bg-gray-200 px-3 py-1 rounded inline-block">01234567</div>
                            </div>
                            
                            <p class="text-xs text-gray-500 mt-4 text-center border-t pt-2">E-ticket ini berlaku sebagai alat validasi masuk studio. Mohon tunjukkan layar ini kepada petugas.</p>
                        </div>
                    </div>
                    
                    <!-- GARIS PERFORASI (Robekan) - Horizontal -->
                    <div class="tear-off-line bg-transparent border-t-2 border-dashed border-gray-500 w-full h-1"></div>

                    <!-- BAGIAN STUB/SOBEK (BAWAH) - Ringkasan data -->
                    <div class="w-full bg-gray-900 text-white p-4 flex flex-row justify-between items-center">
                        
                        <div class="flex flex-col space-y-1">
                            <div class="text-xs font-semibold tracking-wider text-gray-400">TICKET STUB</div>
                            <div id="stub-title" class="text-sm font-bold uppercase truncate">MOVIE TITLE</div>
                            <div id="stub-type" class="text-xs font-medium text-red-400">STANDARD</div>
                        </div>
                        
                        <div class="flex flex-col text-right space-y-1">
                            <div class="text-xs text-gray-400">SEAT / STUDIO</div>
                            <div id="stub-seat" class="text-xl font-bold inline-block text-white">D12</div>
                            <div id="stub-theater" class="text-sm text-gray-400">Studio 2</div>
                        </div>
                    </div>
                </div>
                <p class="absolute bottom-4 text-sm text-gray-500 typewriter-font hidden sm:block">Desain ini akan diubah menjadi JPG saat diunduh.</p>
            </div>
            
        </div>
    </div>

    <!-- Memuat library JavaScript di akhir body untuk memastikan semua elemen HTML telah dimuat -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Variabel global untuk menyimpan data
        let currentSerialNumber = '';
        let ticketData = {};

        // Fungsi untuk menghasilkan Nomor Serial 8 digit acak
        function generateSerialNumber() {
            // Menghasilkan angka 8 digit (10000000 hingga 99999999)
            return Math.floor(10000000 + Math.random() * 90000000).toString();
        }

        // Fungsi untuk memperbarui tampilan tiket berdasarkan input form
        function updateTicketPreview() {
            const form = document.getElementById('ticket-form');
            ticketData.title = form.movieTitle.value.toUpperCase() || 'TITLE MOVIE';
            ticketData.type = form.ticketType.value.toUpperCase() || 'STANDARD';
            ticketData.theater = form.theaterNum.value || '1';
            ticketData.row = form.seatRow.value.toUpperCase() || 'A';
            ticketData.seat = form.seatNum.value || '1';
            ticketData.date = form.date.value || 'YYYY-MM-DD';
            ticketData.time = form.time.value || '00:00';
            // Pastikan harga adalah string dengan dua desimal
            const rawPrice = parseFloat(form.price.value) || 0;
            ticketData.price = rawPrice.toFixed(2);
            
            // Generate Serial Number jika belum ada atau setelah download sebelumnya
            if (!currentSerialNumber || currentSerialNumber === '01234567') { // Menambahkan pengecekan default awal
                currentSerialNumber = generateSerialNumber();
            }
            ticketData.serial = currentSerialNumber;
            
            // Format ulang tanggal
            const dateObj = new Date(ticketData.date);
            const formattedDate = dateObj.toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit', year: 'numeric' });
            
            // Update elemen-elemen di tiket
            
            // Bagian Bawah (Stub) - Sudah diubah agar lebih ringkas dan horizontal
            document.getElementById('stub-title').textContent = ticketData.title;
            document.getElementById('stub-type').textContent = ticketData.type;
            document.getElementById('stub-theater').textContent = `Studio ${ticketData.theater}`; // Tambahkan "Studio" di sini
            document.getElementById('stub-seat').textContent = `${ticketData.row}${ticketData.seat}`;
            
            // Bagian Atas (Main)
            document.getElementById('main-title').textContent = ticketData.title;
            document.getElementById('main-type').textContent = ticketData.type; // Update type di main section
            document.getElementById('main-theater').textContent = ticketData.theater;
            document.getElementById('main-seat').textContent = `${ticketData.row}${ticketData.seat}`;
            document.getElementById('main-date').textContent = formattedDate;
            document.getElementById('main-time').textContent = ticketData.time;
            // Format IDR dengan koma sebagai pemisah desimal
            document.getElementById('main-price').textContent = `IDR ${ticketData.price.replace(/\./g, ',')}`;
            document.getElementById('main-serial').textContent = ticketData.serial;
        }

        // Fungsi utama untuk mengunduh tiket sebagai JPG
        function generateAndDownloadImage() {
            // Pastikan data terbaru sudah terupdate
            updateTicketPreview();

            const ticketElement = document.getElementById('ticket-preview');
            const movieTitle = ticketData.title.replace(/ /g, '_');
            const serialNumber = ticketData.serial;

            // Tampilkan pesan loading
            const loadingMessage = document.getElementById('loading-message');
            const saveText = document.getElementById('save-text');
            saveText.classList.add('hidden');
            loadingMessage.classList.remove('hidden');

            // Gunakan html2canvas untuk mengambil screenshot dari elemen tiket
            html2canvas(ticketElement, { 
                scale: 3, // Skala lebih tinggi untuk resolusi lebih baik
                useCORS: true,
                backgroundColor: '#f3f4f6' // Pastikan latar belakang tetap terlihat bersih
            }).then(canvas => {
                // Konversi canvas menjadi data URL (JPG)
                const imgData = canvas.toDataURL('image/jpeg', 0.9); // Kualitas 90%
                
                // Buat link download
                const link = document.createElement('a');
                link.href = imgData;
                link.download = `e-tiket_${movieTitle}_${serialNumber}.jpg`;
                
                // Simulasikan klik untuk memulai download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // Sembunyikan pesan loading dan tampilkan teks Save kembali
                loadingMessage.classList.add('hidden');
                saveText.classList.remove('hidden');
                
                // Setelah download, generate Serial Number baru untuk entri berikutnya
                currentSerialNumber = generateSerialNumber();
                updateTicketPreview(); // Update preview dengan serial baru
            }).catch(error => {
                console.error("Gagal mengkonversi ke gambar:", error);
                loadingMessage.classList.add('hidden');
                saveText.classList.remove('hidden');
            });
        }

        // Jalankan saat dokumen selesai dimuat
        window.onload = function() {
            // Inisialisasi tampilan awal tiket dan serial number
            currentSerialNumber = generateSerialNumber();
            document.getElementById('ticket-form').reset();
            updateTicketPreview();

            // Tambahkan event listener untuk update preview secara real-time
            const formInputs = document.querySelectorAll('#ticket-form input, #ticket-form select');
            formInputs.forEach(input => {
                input.addEventListener('input', updateTicketPreview);
            });

            // Set aksi untuk tombol Save/Download
            document.getElementById('save-button').addEventListener('click', generateAndDownloadImage);
        };
    </script>
</body>
</html>
